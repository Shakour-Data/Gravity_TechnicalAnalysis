# تغییرات پروژه

این فایل فقط تغییرات منطبق با کد فعلی (نسخه 1.0.0) را ثبت می‌کند.

## [1.0.1] - 2025-12-10
### افزوده شده
- پرچم‌های `ENABLE_SCENARIOS` و `EXPOSE_DB_EXPLORER` برای فعال‌سازی اختیاری سناریو و اکسپلورر DB.
- مستندسازی دقیق‌تر حداقل کندل (۵۰ الزامی، ۶۰+ توصیه‌شده)، نیازمندی مدل‌های ML، و سناریوهای بدون Data Service.
- هشدارهای امنیتی برای CORS/DB Explorer و راهنمای رفع خطای Redis readiness.
- سند فرایند تحلیل تکنیکال و به‌روزرسانی لیست اندیکاتورها؛ ورودی اندیکاتورها با مدل Pydantic.
- اسناد فرایندهای دیگر (الگو، ML، ابزار، بک‌تست، تصمیم‌گیر ۵بعدی، سناریو، کش/داده، ingestion).
- کش و اعتبارسنجی در تشخیص الگو: مدل ML cache، چک ترتیب زمانی، سقف 5000 کندل، و بازتاب وضعیت ML در پاسخ.
- بک‌تست الگو: اعتبارسنجی سفت‌وسخت OHLCV (NaN/Inf/high<low/طول)، اعمال window/step داینامیک، گزارش data_source و warnings، جلوگیری از persist دادهٔ synthetic.
- اعتبارسنجی ورودی‌های ابزار: چک نام ابزارهای ورودی، تایم‌فریم مجاز، سخت‌گیری limit_candles و خطای 400 شفاف در `/tools/*`.
- ماتریس حجم/تصمیم ۵بعدی: حداقل کندل 120/60، ولیدیشن OHLCV، RSI/MFI استاندارد، confidence floor و توافق neutral-safe، هشدار غیرفعال‌شدن حجم.
- سرویس داده/کش: ولیدیشن نماد/تایم‌فریم/بازه، حداقل ۳۰ کندل، چک NaN/Inf/high<low/ترتیب زمانی، کلید کش دقیق‌تر و ثبت cache miss/TTL ۶ساعته.
- اینجکشن نتایج: ولیدیشن payload (نماد/تایم‌فریم/NaN/Inf/حجم ۱۰MB)، dedup درجا، متریک‌های موفق/خطا/تاخیر، retries در مسیر مستقیم و احراز اختیاری.
- اهداف/حدضرر داینامیک ATR-like در تشخیص الگو؛ `ml_status` به خروجی اضافه شد.
- پیش‌بینی ML: مدل fallback در نبود فایل، timeout (2s/5s)، اعتبارسنجی NaN/Inf/بزرگ، محدودیت batch=256 و ادامه در خطای تک‌رکورد.

### تغییر یافته
- Router سناریوها به‌صورت مشروط mount می‌شود؛ DB Explorer فقط در صورت فعال بودن پرچم mount می‌شود.
- حذف دوباره‌گنجانی Router ML و هم‌ترازی README/API_REFERENCE/QUICK_START/PROJECT_STRUCTURE با رفتار واقعی.
- حداقل کندل در endpointهای تحلیل به ۶۰ ارتقا یافت و `analyze/indicators` اکنون دارای اعتبارسنجی بدنه است.
- حداقل کندل در `/patterns/detect` و مسیرهای ابزار به ۶۰ افزایش یافت.

## [1.0.0] - 2025-12-10
### افزوده شده
- سرویس FastAPI با مسیرهای `/api/v1/analyze`, `/patterns`, `/ml`, `/tools`, `/backtest`, `/db`.
- موتور تحلیل کلاسیک با ۶ دسته اندیکاتور، الگوهای شمعی، امواج الیوت، تحلیل فاز بازار و سیگنال نهایی.
- تشخیص الگوهای هارمونیک (Gartley/Butterfly/Bat/Crab) و امتیازدهی ML اختیاری (مدل cache شده).
- توصیه ابزار و تحلیل سفارشی بر پایه کاتالوگ ۹۵+ ابزار و وزن‌دهی ML.
- بک‌تست سبک برای تشخیص الگو؛ ذخیره نتایج در DB در صورت فعال‌سازی ingestion.
- کش Redis اختیاری، سرویس داده خارجی اختیاری، متریک‌های Prometheus اختیاری.

### تغییر یافته
- پاک‌سازی و بازنویسی کامل مستندات برای همخوانی با کد (حذف نسخه‌های قدیمی و فایل‌های تکراری).
- ساختار مستندات ساده‌شده: نمایه جدید، راهنمای API، راهنمای تصمیم ۵بعدی و ماتریس حجم.

### نکات
- Router تحلیل سناریو در کد موجود است ولی به‌صورت پیش‌فرض mount نشده است.
- برای استفاده از endpointهای ML باید فایل‌های مدل در `ml_models/` قرار گیرند.
