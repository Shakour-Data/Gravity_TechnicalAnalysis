# تحلیل فاز بازار بر اساس نظریه داو
## Market Phase Analysis based on Dow Theory

این ماژول تحلیل جامع فاز بازار را بر اساس نظریه داو و اصول Mark Andrew Lim ارائه می‌دهد.

---

## اصول نظریه داو (Dow Theory)

نظریه داو توسط Charles Dow بنیان‌گذار Wall Street Journal در اواخر قرن 19 توسعه یافت و همچنان یکی از پایه‌ای‌ترین نظریه‌های تحلیل تکنیکال است.

### اصول شش‌گانه:

#### 1. بازار همه چیز را تخمین می‌زند (The Market Discounts Everything)
تمام اطلاعات شناخته شده در قیمت منعکس شده است - اخبار، احساسات، انتظارات.

#### 2. روندها سه‌گانه هستند (There Are Three Trends)
- **روند اصلی (Primary Trend)**: روند بزرگ که ماه‌ها یا سال‌ها طول می‌کشد
- **روند ثانویه (Secondary Trend)**: اصلاحات در روند اصلی که هفته‌ها یا ماه‌ها طول می‌کشد
- **روند جزئی (Minor Trend)**: نوسانات روزانه

#### 3. روندهای اصلی سه فاز دارند (Primary Trends Have Three Phases)

**در روند صعودی:**
1. **فاز انباشت (Accumulation)**: سرمایه‌گذاران باهوش خرید می‌کنند
2. **فاز مشارکت عمومی (Public Participation)**: عموم وارد می‌شوند، قیمت‌ها به سرعت بالا می‌روند
3. **فاز توزیع (Distribution)**: سرمایه‌گذاران باهوش می‌فروشند

**در روند نزولی:**
1. **فاز توزیع (Distribution)**: سرمایه‌گذاران باهوش می‌فروشند
2. **فاز مشارکت عمومی (Public Participation)**: فروش عمومی، قیمت‌ها به سرعت پایین می‌آیند
3. **فاز انباشت (Accumulation)**: سرمایه‌گذاران باهوش دوباره خرید می‌کنند

#### 4. اندیکاتورها باید یکدیگر را تایید کنند (Indices Must Confirm Each Other)
برای تایید یک روند، تمام شاخص‌های اصلی باید هماهنگ باشند.

#### 5. حجم باید روند را تایید کند (Volume Must Confirm the Trend)
- در روند صعودی: حجم در روزهای صعودی باید بیشتر باشد
- در روند نزولی: حجم در روزهای نزولی باید بیشتر باشد

#### 6. روندها تا سیگنال قطعی معکوس ادامه دارند (Trends Persist Until Definitive Reversal)
یک روند فعال فرض می‌شود تا زمانی که شواهد محکمی از معکوس شدن آن ظاهر شود.

---

## چهار فاز بازار (Four Market Phases)

### 1. فاز انباشت (Accumulation Phase)
**ویژگی‌ها:**
- قیمت در یک محدوده حرکت می‌کند (Range-bound)
- حجم معاملات کم است و رو به کاهش
- معمولاً پس از یک روند نزولی اتفاق می‌افتد
- سرمایه‌گذاران باتجربه به آرامی خرید می‌کنند
- احساسات عمومی منفی یا بی‌تفاوت است

**شناسایی:**
```
✓ Trend Structure: Contraction یا Mixed
✓ Volume: کاهشی یا ثابت
✓ Price: نزدیک به سطوح پایین اخیر
✓ Momentum: خنثی یا در حال بهبود تدریجی
✓ RSI: زیر 50
```

**استراتژی معاملاتی:**
- فرصت مناسب برای خرید تدریجی
- ایجاد موقعیت‌های بلندمدت
- صبر برای breakout از محدوده

---

### 2. فاز صعود - Markup (Bullish Trend Phase)
**ویژگی‌ها:**
- قیمت Higher Highs و Higher Lows می‌سازد
- حجم در روزهای صعودی افزایش می‌یابد
- عموم مردم وارد بازار می‌شوند
- احساسات عمومی خوش‌بینانه است
- خبرها مثبت می‌شوند

**شناسایی:**
```
✓ Trend Structure: Uptrend (HH & HL)
✓ Volume: افزایش در روزهای صعودی
✓ Price: بالای SMA 20 و SMA 50
✓ Momentum: قوی (RSI > 50)
✓ MACD: مثبت و در حال افزایش
```

**استراتژی معاملاتی:**
- نگهداری موقعیت‌های خرید
- جابجایی Stop Loss به بالای نقاط پایین قبلی
- اجازه دادن به سودها برای رشد (Let profits run)
- استفاده از Trailing Stop

---

### 3. فاز توزیع (Distribution Phase)
**ویژگی‌ها:**
- قیمت در یک محدوده بالا حرکت می‌کند
- حجم معاملات بالا (سرمایه‌گذاران باهوش می‌فروشند)
- معمولاً پس از یک روند صعودی طولانی اتفاق می‌افتد
- احساسات عمومی هنوز خوش‌بینانه است
- اما Momentum در حال ضعیف شدن است

**شناسایی:**
```
✓ Trend Structure: Contraction یا Expansion
✓ Volume: بالا ولی قیمت پیشرفت نمی‌کند
✓ Price: در محدوده بالا
✓ Momentum: در حال ضعیف شدن
✓ RSI: بالای 50 ولی Divergence منفی
```

**استراتژی معاملاتی:**
- کاهش تدریجی موقعیت‌های خرید
- عدم ورود به موقعیت‌های جدید
- محافظت از سودها با Stop Loss سفت
- آماده شدن برای خروج

---

### 4. فاز نزول - Markdown (Bearish Trend Phase)
**ویژگی‌ها:**
- قیمت Lower Lows و Lower Highs می‌سازد
- حجم در روزهای نزولی افزایش می‌یابد
- فروش عمومی و هراس
- احساسات عمومی بدبینانه است
- خبرها منفی می‌شوند

**شناسایی:**
```
✓ Trend Structure: Downtrend (LL & LH)
✓ Volume: افزایش در روزهای نزولی
✓ Price: پایین SMA 20 و SMA 50
✓ Momentum: ضعیف (RSI < 50)
✓ MACD: منفی و در حال کاهش
```

**استراتژی معاملاتی:**
- دوری از موقعیت‌های خرید
- در صورت تجربه: موقعیت‌های فروش
- حفاظت از سرمایه
- منتظر علائم پایان روند نزولی

---

## پیاده‌سازی در این میکروسرویس

### فایل‌ها:
- `analysis/market_phase.py`: ماژول اصلی تحلیل فاز
- `models/schemas.py`: مدل `MarketPhaseResult`
- `services/analysis_service.py`: ادغام با تحلیل کامل

### استفاده:

```python
from analysis.market_phase import analyze_market_phase

# تحلیل فاز بازار
result = analyze_market_phase(candles)

print(f"Phase: {result['market_phase']}")
print(f"Strength: {result['phase_strength']}")
print(f"Recommendations: {result['recommendations']}")
```

### خروجی:

```python
{
    "market_phase": "صعود",  # یا انباشت، توزیع، نزول، انتقال
    "phase_strength": "قوی",
    "description": "بازار در فاز صعودی است...",
    "overall_score": 72.5,
    "trend_structure": "uptrend",
    "volume_confirmation": True,
    "recommendations": [
        "ادامه نگهداری موقعیت‌های خرید",
        "استفاده از استراتژی trend-following",
        ...
    ],
    "dow_theory_compliance": True
}
```

---

## تضمین سازگاری با نظریه داو

این میکروسرویس تضمین می‌کند که:

1. ✅ **تمام تحلیل‌ها با نظریه داو سازگار هستند**
2. ✅ **هیچ سیگنالی خلاف اصول داو صادر نمی‌شود**
3. ✅ **حجم معاملات همیشه بررسی و تایید می‌شود**
4. ✅ **ساختار روند (HH/HL یا LH/LL) اساس شناسایی فاز است**
5. ✅ **توصیه‌ها بر اساس فاز فعلی و اصول داو ارائه می‌شوند**

---

## منابع

- **Charles Dow**: بنیان‌گذار نظریه داو
- **Mark Andrew Lim**: تحلیل فازهای بازار در تحلیل تکنیکال
- **Robert Rhea**: "The Dow Theory" (1932)
- **Richard Russell**: "Dow Theory Letters"

---

## مثال‌های عملی

### مثال 1: تشخیص فاز صعود
```python
# داده‌های بازار صعودی
candles = generate_uptrend_candles(100)
result = analyze_market_phase(candles)

# خروجی:
# Phase: صعود
# Strength: بسیار قوی
# Recommendations: نگهداری موقعیت‌ها، trailing stop
```

### مثال 2: تشخیص فاز انباشت
```python
# داده‌های بازار range-bound با حجم کم
candles = generate_accumulation_candles(100)
result = analyze_market_phase(candles)

# خروجی:
# Phase: انباشت
# Strength: قوی
# Recommendations: خرید تدریجی، آماده برای breakout
```

---

## نتیجه‌گیری

تحلیل فاز بازار بر اساس نظریه داو یکی از قدرتمندترین ابزارهای تحلیل تکنیکال است. با شناسایی صحیح فاز فعلی بازار، معامله‌گران می‌توانند:

- استراتژی مناسب را انتخاب کنند
- ریسک را بهتر مدیریت کنند
- در جهت روند اصلی معامله کنند
- از ورود در زمان‌های نامناسب اجتناب کنند

**این میکروسرویس همه این قابلیت‌ها را با رعایت کامل نظریه داو فراهم می‌کند.**
